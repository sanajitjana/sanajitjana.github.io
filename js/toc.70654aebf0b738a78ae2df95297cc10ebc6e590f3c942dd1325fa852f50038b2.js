(()=>{var n=class{constructor(){this.elements={},this.gumshoe=null,this.isVisible=!1,this.init()}init(){this.cacheElements(),this.elements.card&&(this.bindEvents(),this.initGumshoe(),this.exposeAPI())}cacheElements(){this.elements={card:document.getElementById("toc-card"),overlay:document.getElementById("toc-overlay"),closeBtn:document.getElementById("toc-close"),content:document.getElementById("toc-content")}}bindEvents(){let{closeBtn:e,overlay:t,content:s}=this.elements;e?.addEventListener("click",()=>this.hide()),t?.addEventListener("click",()=>this.hide()),document.addEventListener("keydown",i=>{i.key==="Escape"&&this.isVisible&&this.hide()}),s?.addEventListener("click",i=>{let o=i.target.closest('a[href^="#"]');o&&(i.preventDefault(),this.scrollToTarget(o.hash))})}scrollToTarget(e){let t=this.decodeHash(e),s=document.getElementById(t);s&&(s.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>this.hide(),300))}decodeHash(e){try{return decodeURIComponent(e.substring(1))}catch{return console.warn("Hash \u89E3\u7801\u5931\u8D25:",e),e.substring(1)}}initGumshoe(){if(typeof Gumshoe>"u"){console.warn("Gumshoe \u5E93\u672A\u52A0\u8F7D");return}document.querySelectorAll("#toc-content a").length!==0&&(this.gumshoe=new Gumshoe("#toc-content a",{offset:()=>window.innerHeight*.2,reflow:!0,nested:!0,nestedClass:"active-parent",navClass:"active",contentClass:"active",events:!0}))}show(){!this.elements.card||this.isVisible||(this.isVisible=!0,this.toggleElements(!0),document.body.style.overflow="hidden")}hide(){!this.elements.card||!this.isVisible||(this.isVisible=!1,this.toggleElements(!1),document.body.style.overflow="")}toggle(){this.isVisible?this.hide():this.show()}toggleElements(e){let{card:t,overlay:s}=this.elements;e?(s.classList.remove("opacity-0","pointer-events-none"),s.classList.add("opacity-100"),t.classList.remove("opacity-0","scale-95","pointer-events-none"),t.classList.add("opacity-100","scale-100")):(s.classList.add("opacity-0","pointer-events-none"),s.classList.remove("opacity-100"),t.classList.add("opacity-0","scale-95","pointer-events-none"),t.classList.remove("opacity-100","scale-100"))}exposeAPI(){window.TOC={show:()=>this.show(),hide:()=>this.hide(),toggle:()=>this.toggle(),isVisible:()=>this.isVisible,initialized:!0}}destroy(){this.gumshoe?.destroy(),document.body.style.overflow=""}};function c(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>new n):setTimeout(()=>new n,50)}window.addEventListener("beforeunload",()=>{window.tocManager?.destroy()});c();})();
