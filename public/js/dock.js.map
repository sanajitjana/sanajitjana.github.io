{"version":3,"sources":["file:///d:/My%20Projects/sanajitjana.github.io/themes/hugo-narrow/assets/js/dock.js"],"sourcesContent":["/**\r\n * 底部 Dock 控制脚本\r\n *\r\n * 功能：\r\n * - 支持三种显示模式：scroll（向上滚动显示）、always（始终显示）、float（悬浮显示）\r\n * - 基础的按钮点击事件处理\r\n */\r\n\r\n(function () {\r\n  \"use strict\";\r\n\r\n  let lastScrollTop = 0;\r\n  let isScrollingUp = false;\r\n  let scrollThreshold = 100; // 滚动阈值\r\n  let isDockVisible = false; // 悬浮模式的显示状态\r\n\r\n  const dock = document.getElementById(\"dock\");\r\n  const floatTrigger = document.getElementById(\"dock-float-trigger\");\r\n\r\n  if (!dock) return;\r\n\r\n  // 获取 dock 显示模式\r\n  const dockMode = dock.dataset.dockMode || \"scroll\";\r\n\r\n  // 滚动事件处理\r\n  function handleScroll() {\r\n    const currentScrollTop =\r\n      window.pageYOffset || document.documentElement.scrollTop;\r\n\r\n    // 判断滚动方向\r\n    if (currentScrollTop \u003c lastScrollTop) {\r\n      // 向上滚动\r\n      isScrollingUp = true;\r\n    } else {\r\n      // 向下滚动\r\n      isScrollingUp = false;\r\n    }\r\n\r\n    // 根据模式处理显示/隐藏 dock\r\n    switch (dockMode) {\r\n      case \"scroll\":\r\n        if (isScrollingUp \u0026\u0026 currentScrollTop \u003e scrollThreshold) {\r\n          showDock();\r\n        } else if (!isScrollingUp || currentScrollTop \u003c= scrollThreshold) {\r\n          hideDock();\r\n        }\r\n        break;\r\n      case \"always\":\r\n        showDock();\r\n        break;\r\n      case \"float\":\r\n        // 悬浮模式在滚动时自动隐藏 dock\r\n        if (isDockVisible \u0026\u0026 (currentScrollTop \u003e lastScrollTop)) {\r\n          hideDock();\r\n        }\r\n        break;\r\n    }\r\n\r\n    lastScrollTop = currentScrollTop;\r\n  }\r\n\r\n  // 显示 dock\r\n  function showDock() {\r\n    dock.classList.remove(\"translate-y-24\", \"opacity-0\", \"pointer-events-none\");\r\n    dock.classList.add(\"translate-y-0\", \"opacity-100\", \"pointer-events-auto\");\r\n    isDockVisible = true;\r\n  }\r\n\r\n  // 隐藏 dock\r\n  function hideDock() {\r\n    dock.classList.remove(\r\n      \"translate-y-0\",\r\n      \"opacity-100\",\r\n      \"pointer-events-auto\",\r\n    );\r\n    dock.classList.add(\"translate-y-24\", \"opacity-0\", \"pointer-events-none\");\r\n    isDockVisible = false;\r\n  }\r\n\r\n  // 切换悬浮模式 dock 显示状态\r\n  function toggleFloatDock() {\r\n    if (isDockVisible) {\r\n      hideDock();\r\n    } else {\r\n      showDock();\r\n    }\r\n  }\r\n\r\n  // 节流函数\r\n  function throttle(func, limit) {\r\n    let inThrottle;\r\n    return function () {\r\n      const args = arguments;\r\n      const context = this;\r\n      if (!inThrottle) {\r\n        func.apply(context, args);\r\n        inThrottle = true;\r\n        setTimeout(() =\u003e (inThrottle = false), limit);\r\n      }\r\n    };\r\n  }\r\n\r\n  // 绑定滚动事件（使用节流）\r\n  window.addEventListener(\"scroll\", throttle(handleScroll, 16)); // ~60fps\r\n\r\n  // 悬浮模式触发器事件处理\r\n  if (floatTrigger \u0026\u0026 dockMode === \"float\") {\r\n    let hoverTimer;\r\n    \r\n    // 点击触发器切换 dock\r\n    floatTrigger.addEventListener(\"click\", function (e) {\r\n      e.preventDefault();\r\n      toggleFloatDock();\r\n    });\r\n\r\n    // 悬浮显示 dock\r\n    floatTrigger.addEventListener(\"mouseenter\", function () {\r\n      clearTimeout(hoverTimer);\r\n      hoverTimer = setTimeout(() =\u003e {\r\n        if (!isDockVisible) {\r\n          showDock();\r\n        }\r\n      }, 150); // 150ms 延迟，避免误触发\r\n    });\r\n\r\n    floatTrigger.addEventListener(\"mouseleave\", function () {\r\n      clearTimeout(hoverTimer);\r\n      // 鼠标离开时隐藏 dock\r\n      setTimeout(() =\u003e {\r\n        if (isDockVisible \u0026\u0026 !dock.matches(':hover')) {\r\n          hideDock();\r\n        }\r\n      }, 200);\r\n    });\r\n\r\n    // dock 区域悬浮时保持显示\r\n    dock.addEventListener(\"mouseenter\", function () {\r\n      clearTimeout(hoverTimer);\r\n    });\r\n\r\n    dock.addEventListener(\"mouseleave\", function () {\r\n      setTimeout(() =\u003e {\r\n        if (isDockVisible \u0026\u0026 !floatTrigger.matches(':hover')) {\r\n          hideDock();\r\n        }\r\n      }, 200);\r\n    });\r\n\r\n    // 点击页面其他区域时隐藏 dock\r\n    document.addEventListener(\"click\", function (e) {\r\n      if (isDockVisible \u0026\u0026 !dock.contains(e.target) \u0026\u0026 !floatTrigger.contains(e.target)) {\r\n        hideDock();\r\n      }\r\n    });\r\n\r\n    // 阻止 dock 内部点击事件冒泡\r\n    dock.addEventListener(\"click\", function (e) {\r\n      e.stopPropagation();\r\n    });\r\n  }\r\n\r\n  // 基础按钮事件处理（占位符，后续实现具体功能）\r\n\r\n  // 返回按钮 - 只在非首页存在\r\n  const backBtn = document.getElementById(\"dock-back\");\r\n  if (backBtn) {\r\n    backBtn.addEventListener(\"click\", function (e) {\r\n      e.preventDefault();\r\n\r\n      // 实现智能返回功能\r\n      try {\r\n        // 检查是否有历史记录可以返回\r\n        if (window.history.length \u003e 1 \u0026\u0026 document.referrer) {\r\n          // 如果有引用页面且在同一域名下，使用浏览器返回\r\n          const referrerUrl = new URL(document.referrer);\r\n          const currentUrl = new URL(window.location.href);\r\n\r\n          if (referrerUrl.origin === currentUrl.origin) {\r\n            window.history.back();\r\n            console.log(\"返回按钮点击 - 浏览器返回\");\r\n            return;\r\n          }\r\n        }\r\n\r\n        // 否则跳转到首页\r\n        window.location.href = \"/\";\r\n        console.log(\"返回按钮点击 - 跳转首页\");\r\n      } catch (error) {\r\n        // 如果出现错误，默认跳转到首页\r\n        console.warn(\"返回功能出错，跳转到首页:\", error);\r\n        window.location.href = \"/\";\r\n      }\r\n    });\r\n  }\r\n\r\n  // 目录按钮 - 只在文章页面存在\r\n  const tocBtn = document.getElementById(\"dock-toc\");\r\n  if (tocBtn) {\r\n    tocBtn.addEventListener(\"click\", function (e) {\r\n      e.preventDefault();\r\n\r\n      // 调用目录功能，带重试机制\r\n      function tryToggleTOC(retries = 5) {\r\n        if (window.TOC \u0026\u0026 window.TOC.initialized) {\r\n          // 如果搜索modal是打开状态，先关闭搜索\r\n          if (window.Search \u0026\u0026 window.Search.isVisible \u0026\u0026 window.Search.isVisible()) {\r\n            window.Search.hide();\r\n          }\r\n          \r\n          // 切换目录状态\r\n          window.TOC.toggle();\r\n        } else if (window.TOC \u0026\u0026 !window.TOC.initialized \u0026\u0026 retries \u003e 0) {\r\n          setTimeout(() =\u003e tryToggleTOC(retries - 1), 200);\r\n        } else if (!window.TOC \u0026\u0026 retries \u003e 0) {\r\n          setTimeout(() =\u003e tryToggleTOC(retries - 1), 200);\r\n        }\r\n      }\r\n\r\n      tryToggleTOC();\r\n    });\r\n  }\r\n\r\n  // 搜索按钮\r\n  const searchBtn = document.getElementById(\"dock-search\");\r\n  if (searchBtn) {\r\n    searchBtn.addEventListener(\"click\", function (e) {\r\n      e.preventDefault();\r\n\r\n      // 调用搜索功能，带重试机制\r\n      function tryToggleSearch(retries = 5) {\r\n        if (window.Search) {\r\n          // 如果目录modal是打开状态，先关闭目录\r\n          if (window.TOC \u0026\u0026 window.TOC.initialized \u0026\u0026 window.TOC.isVisible \u0026\u0026 window.TOC.isVisible()) {\r\n            window.TOC.hide();\r\n          }\r\n          \r\n          // 切换搜索状态（如果已打开则关闭，否则打开）\r\n          if (window.Search.isVisible \u0026\u0026 window.Search.isVisible()) {\r\n            window.Search.hide();\r\n          } else {\r\n            window.Search.show();\r\n          }\r\n        } else if (retries \u003e 0) {\r\n          setTimeout(() =\u003e tryToggleSearch(retries - 1), 200);\r\n        }\r\n      }\r\n\r\n      tryToggleSearch();\r\n    });\r\n  }\r\n\r\n  // 评论按钮 - 只在文章页面且评论启用时存在\r\n  const commentsBtn = document.getElementById(\"dock-comments\");\r\n  if (commentsBtn) {\r\n    commentsBtn.addEventListener(\"click\", function (e) {\r\n      e.preventDefault();\r\n\r\n      // 实现滚动到评论区域功能\r\n      try {\r\n        // 尝试多种可能的评论区域选择器\r\n        const commentSelectors = [\r\n          \"#comments\", // 通用评论区域 ID\r\n          \".comments\", // 通用评论区域类\r\n          \"#giscus-container\", // Giscus 评论系统\r\n          \".giscus\", // Giscus 评论系统类\r\n          \"#disqus_thread\", // Disqus 评论系统\r\n          \".disqus\", // Disqus 评论系统类\r\n          \"#utterances\", // Utterances 评论系统\r\n          \".utterances\", // Utterances 评论系统类\r\n          \"#waline\", // Waline 评论系统\r\n          \".waline\", // Waline 评论系统类\r\n          \"[data-comments]\", // 带有 data-comments 属性的元素\r\n          \".comment-section\", // 评论区域类\r\n          \".post-comments\", // 文章评论类\r\n        ];\r\n\r\n        let commentElement = null;\r\n\r\n        // 按优先级查找评论元素\r\n        for (const selector of commentSelectors) {\r\n          commentElement = document.querySelector(selector);\r\n          if (commentElement) {\r\n            console.log(`找到评论区域: ${selector}`);\r\n            break;\r\n          }\r\n        }\r\n\r\n        if (commentElement) {\r\n          // 平滑滚动到评论区域\r\n          commentElement.scrollIntoView({\r\n            behavior: \"smooth\",\r\n            block: \"start\",\r\n            inline: \"nearest\",\r\n          });\r\n          console.log(\"评论按钮点击 - 滚动到评论区域\");\r\n        } else {\r\n          // 如果找不到评论区域，滚动到页面底部\r\n          window.scrollTo({\r\n            top: document.documentElement.scrollHeight,\r\n            behavior: \"smooth\",\r\n          });\r\n          console.log(\"评论按钮点击 - 未找到评论区域，滚动到页面底部\");\r\n        }\r\n      } catch (error) {\r\n        console.warn(\"滚动到评论区域失败:\", error);\r\n        // 出错时滚动到页面底部\r\n        window.scrollTo({\r\n          top: document.documentElement.scrollHeight,\r\n          behavior: \"smooth\",\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  // 返回顶部按钮\r\n  const topBtn = document.getElementById(\"dock-top\");\r\n  if (topBtn) {\r\n    topBtn.addEventListener(\"click\", function () {\r\n      // 平滑滚动到顶部\r\n      window.scrollTo({\r\n        top: 0,\r\n        behavior: \"smooth\",\r\n      });\r\n    });\r\n  }\r\n\r\n  // 初始化：根据模式设置 dock 状态\r\n  switch (dockMode) {\r\n    case \"always\":\r\n      showDock();\r\n      break;\r\n    case \"float\":\r\n      hideDock();\r\n      // 确保悬浮触发器可见\r\n      if (floatTrigger) {\r\n        floatTrigger.style.opacity = \"1\";\r\n      }\r\n      break;\r\n    case \"scroll\":\r\n    default:\r\n      hideDock();\r\n      break;\r\n  }\r\n\r\n  // 调试信息\r\n  if (\r\n    window.location.hostname === \"localhost\" ||\r\n    window.location.hostname === \"127.0.0.1\"\r\n  ) {\r\n    console.log(\r\n      \"Dock initialized successfully - positioned at perfect center bottom\",\r\n    );\r\n  }\r\n})();\r\n"],"mappings":"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","names":[]}